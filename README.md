# ü§ñ Kavak AI Agent

## üì± Ejemplos de Conversaci√≥n

### Previsualizaci√≥n de la Conversaci√≥n
Aqu√≠ puedes ver ejemplos visuales de c√≥mo se ve la conversaci√≥n en WhatsApp:

![Conversaci√≥n 1](docs/images/IMG_9031.PNG)
![Conversaci√≥n 2](docs/images/IMG_9032.PNG)
![Conversaci√≥n 3](docs/images/IMG_9033.PNG)
![Conversaci√≥n 4](docs/images/IMG_9034.PNG)
![Conversaci√≥n 5](docs/images/IMG_9035.PNG)

### 1. B√∫squeda Inicial
```
[Usuario] Hola üëã
[Bot] ¬°Hola! Soy tu asistente para encontrar el auto ideal en Kavak üöó
¬øQu√© tipo de auto est√°s buscando?

[Usuario] Busco un auto econ√≥mico familiar
[Bot] Entiendo que buscas un auto econ√≥mico y familiar. Te sugiero estas opciones:

üöó Chevrolet Spark ACTIV D 2021
üí∞ $325,000
üìè 5 puertas
üéµ Bluetooth y CarPlay
‚õΩ Econ√≥mico en consumo

üöó Volkswagen Vento 2020
üí∞ $350,000
üìè 4 puertas
üéµ Bluetooth y CarPlay
üõãÔ∏è Espacioso

¬øTe gustar√≠a saber m√°s detalles de alguno de estos autos?
```

### 2. Consulta de Caracter√≠sticas
```
[Usuario] ¬øTiene bluetooth el Spark?
[Bot] ¬°S√≠! El Chevrolet Spark ACTIV D incluye:
üéµ Bluetooth
üì± CarPlay
üéß Entrada auxiliar
üîä 6 bocinas

¬øTe gustar√≠a agendar una cita para conocerlo en persona? 
Tambi√©n puedo mostrarte m√°s opciones si lo prefieres.

[Usuario] Mu√©strame m√°s opciones
[Bot] Aqu√≠ tienes m√°s opciones econ√≥micas y familiares:

üöó Nissan Versa 2021
üí∞ $340,000
üìè 4 puertas
üéµ Bluetooth y CarPlay
üõãÔ∏è Amplio espacio interior

üöó Kia Rio 2020
üí∞ $360,000
üìè 4 puertas
üéµ Bluetooth y CarPlay
üîã Bajo consumo de combustible

¬øAlguna de estas opciones te interesa? Puedo darte m√°s detalles o ayudarte a calcular el financiamiento.
```

### 3. Financiamiento
```
[Usuario] ¬øCu√°nto ser√≠a la mensualidad del Versa?
[Bot] Para el Nissan Versa 2021 ($340,000), te muestro las opciones de financiamiento:

üìä Opci√≥n 1:
üí∞ Enganche: $68,000 (20%)
üìÖ Plazo: 48 meses
üíµ Mensualidad: $7,850
üìà Tasa: 10.9% anual

üìä Opci√≥n 2:
üí∞ Enganche: $102,000 (30%)
üìÖ Plazo: 36 meses
üíµ Mensualidad: $8,200
üìà Tasa: 10.5% anual

¬øTe gustar√≠a agendar una cita para revisar el auto y formalizar el financiamiento?
```

### 4. Agendamiento de Cita
```
[Usuario] S√≠, me interesa
[Bot] Perfecto, para agendar tu cita necesito algunos datos:

1Ô∏è‚É£ ¬øQu√© d√≠a te gustar√≠a visitarnos? (L-V 9:00-18:00, S 9:00-14:00)
2Ô∏è‚É£ ¬øA qu√© hora te acomoda?
3Ô∏è‚É£ ¬øCu√°l es tu nombre completo?

[Usuario] Ma√±ana a las 11
[Bot] Para agendar tu cita necesito tu nombre completo para registrarte en el sistema.

[Usuario] Juan P√©rez
[Bot] ¬°Perfecto! Tu cita ha sido agendada:

üìÖ Fecha: [Fecha de ma√±ana]
‚è∞ Hora: 11:00
üöó Auto: Nissan Versa 2021
üë§ Nombre: Juan P√©rez

Te enviar√© un recordatorio por WhatsApp. ¬øHay algo m√°s en lo que pueda ayudarte?
```

### 5. Finalizaci√≥n y MSAT
```
[Usuario] No, gracias
[Bot] ¬°Gracias por tu inter√©s! 

¬øPodr√≠as calificar tu experiencia con nuestro asistente del 1 al 5, donde:
1 = Muy insatisfecho
2 = Insatisfecho
3 = Neutral
4 = Satisfecho
5 = Muy satisfecho

Responde solo con el n√∫mero de tu calificaci√≥n.

[Usuario] 5
[Bot] ¬°Gracias por tu excelente calificaci√≥n! üôè 
Nos alegra que hayas tenido una gran experiencia con nuestro asistente.
```

## üì± Asistente de IA para Kavak

Asistente de IA para ayudar a los clientes a encontrar su auto ideal en el cat√°logo de Kavak.

## Prueba de la Aplicaci√≥n

### 1. Configurar WhatsApp Sandbox
1. Abrir WhatsApp en tu tel√©fono
2. Agregar el n√∫mero: +14155238886
3. Enviar mensaje: `join look-quietly`
4. Esperar confirmaci√≥n de que te has unido al sandbox

Alternativamente, puedes:
- Hacer clic en [este enlace](http://wa.me/+14155238886?text=join%20look-quietly) para abrir WhatsApp directamente
- Escanear el c√≥digo QR (si est√° disponible)
- Enviar mensaje: `join look-quietly`

### 2. Probar la Aplicaci√≥n
Una vez unido al sandbox, puedes probar los siguientes comandos:

#### B√∫squeda de Autos
```
Hola, busco un auto econ√≥mico familiar
```
```
Mu√©strame Volkswagens Golf
```
```
Autos entre 300 y 400 mil pesos
```
```
Autos con bluetooth y carplay
```

#### Financiamiento
```
Calcula el financiamiento para un auto de 500 mil pesos con enganche de 100 mil
```
```
Mu√©strame opciones a 48 meses
```

#### Detalles
```
Dame m√°s detalles del Volkswagen Golf GTI Performance
```
```
Mu√©strame m√°s Chevrolets Spark ACTIV D
```

### 3. Verificar Funcionamiento
1. **Respuestas del Bot**:
   - Deber√≠as recibir respuestas en segundos
   - Las respuestas deben ser relevantes a tu b√∫squeda
   - El bot debe mantener el contexto de la conversaci√≥n

2. **Monitoreo**:
   - Revisar CloudWatch Logs para ver el flujo de la conversaci√≥n
   - Verificar Step Functions para ver el procesamiento
   - Monitorear DynamoDB para ver las consultas

3. **Soluci√≥n de Problemas**:
   - Si no recibes respuesta, verificar:
     - Que est√°s en el sandbox correcto
     - Que el webhook est√° configurado
     - Que las funciones Lambda est√°n activas
   - Si la respuesta es incorrecta:
     - Verificar logs de la funci√≥n de chat
     - Revisar embeddings en DynamoDB
     - Comprobar el cat√°logo de autos

### 4. Notas Importantes
- El sandbox de WhatsApp tiene l√≠mites de uso
- Las respuestas pueden tardar unos segundos
- El bot mantiene contexto por 24 horas
- Los embeddings se actualizan diariamente
- Las b√∫squedas son sem√°nticas, puedes usar lenguaje natural

## Caracter√≠sticas

### B√∫squeda Sem√°ntica de Autos
- B√∫squeda por descripci√≥n natural (ej: "un auto econ√≥mico familiar")
- B√∫squeda por marca y modelo espec√≠ficos
- B√∫squeda por rango de precio y a√±o
- B√∫squeda por caracter√≠sticas espec√≠ficas (bluetooth, carplay)
- Resultados ordenados por relevancia

### Caracter√≠sticas Disponibles
- Marca, modelo, versi√≥n y a√±o
- Precio y kilometraje
- Dimensiones (largo, ancho, altura)
- Caracter√≠sticas (bluetooth, carplay)

### Financiamiento
- C√°lculo de opciones de financiamiento
- Diferentes plazos (36 a 72 meses)
- Tasa de inter√©s personalizable
- C√°lculo de mensualidades

### Conversaci√≥n Natural
- Mantiene contexto de la conversaci√≥n
- Resumen autom√°tico de preferencias
- Respuestas personalizadas
- Manejo de m√∫ltiples criterios de b√∫squeda

## Arquitectura

### Diagrama General
```mermaid
graph TB
    subgraph Cliente
        WA[WhatsApp] -->|Mensaje| TW[Twilio]
    end

    subgraph AWS
        subgraph API Gateway
            TW -->|Webhook| APIG[API Gateway]
        end

        subgraph Step Functions
            APIG -->|Inicia| SF1[Flujo de Conversaci√≥n]
            SF1 -->|Procesa| L1[Lambda Chat]
            SF1 -->|Actualiza| L2[Lambda Embeddings]
            SF1 -->|Responde| L3[Lambda Webhook]
            
            CW[CloudWatch Events] -->|Diario| SF2[Flujo de Embeddings]
            SF2 -->|Actualiza| L2
        end

        subgraph DynamoDB
            L1 -->|Lee/Escribe| DB1[Conversaciones]
            L2 -->|Lee/Escribe| DB2[Embeddings]
            L2 -->|Lee| DB3[Cat√°logo]
        end

        subgraph OpenAI
            L1 -->|Consulta| GPT[GPT-3.5 Turbo]
            L2 -->|Genera| EMB[Embeddings API]
        end
    end

    L3 -->|Respuesta| WA
```

### Flujos Detallados

#### 1. Flujo de Conversaci√≥n
```mermaid
stateDiagram-v2
    [*] --> RecibirMensaje
    RecibirMensaje --> ProcesarMensaje
    ProcesarMensaje --> VerificarContexto
    
    VerificarContexto --> BuscarEmbedding: Necesita Embedding
    VerificarContexto --> GenerarRespuesta: No necesita Embedding
    
    BuscarEmbedding --> ActualizarEmbedding: No existe
    BuscarEmbedding --> GenerarRespuesta: Existe
    
    ActualizarEmbedding --> GenerarRespuesta
    GenerarRespuesta --> EnviarRespuesta
    EnviarRespuesta --> ActualizarContexto
    ActualizarContexto --> [*]
    
    state VerificarContexto {
        [*] --> ConsultarDynamoDB
        ConsultarDynamoDB --> VerificarTimestamp
        VerificarTimestamp --> [*]
    }
    
    state GenerarRespuesta {
        [*] --> ConsultarGPT
        ConsultarGPT --> FormatearRespuesta
        FormatearRespuesta --> [*]
    }
```

#### 2. Flujo de Actualizaci√≥n de Embeddings
```mermaid
stateDiagram-v2
    [*] --> TriggerDiario
    TriggerDiario --> ObtenerCatalogo
    
    state ProcesarLote {
        [*] --> ObtenerLote
        ObtenerLote --> GenerarEmbedding
        GenerarEmbedding --> GuardarDynamoDB
        GuardarDynamoDB --> [*]
    }
    
    ObtenerCatalogo --> ProcesarLote
    ProcesarLote --> VerificarMasLotes
    
    VerificarMasLotes --> ProcesarLote: Hay m√°s lotes
    VerificarMasLotes --> Finalizar: No hay m√°s lotes
    Finalizar --> [*]
    
    state GenerarEmbedding {
        [*] --> NormalizarTexto
        NormalizarTexto --> ConsultarOpenAI
        ConsultarOpenAI --> [*]
    }
```

### Componentes y Responsabilidades

#### 1. Frontend (WhatsApp + Twilio)
- **WhatsApp**: Interfaz de usuario
- **Twilio**: 
  - Recibe mensajes de WhatsApp
  - Env√≠a mensajes al webhook
  - Maneja la sesi√≥n de WhatsApp

#### 2. API Gateway
- Expone endpoints para:
  - Webhook de Twilio
  - Actualizaci√≥n de embeddings
  - Monitoreo y salud

#### 3. Step Functions
- **Flujo de Conversaci√≥n**:
  - Orquesta el procesamiento de mensajes
  - Maneja actualizaciones de embeddings
  - Gestiona el contexto de la conversaci√≥n
  - Coordina la generaci√≥n de respuestas

- **Flujo de Embeddings**:
  - Se ejecuta diariamente
  - Procesa el cat√°logo en lotes
  - Actualiza embeddings desactualizados
  - Maneja errores y reintentos

#### 4. Lambda Functions
- **Chat**:
  - Procesa mensajes del usuario
  - Consulta GPT-3.5
  - Maneja el contexto de la conversaci√≥n
  - Genera respuestas personalizadas

- **Embeddings**:
  - Genera embeddings para autos
  - Actualiza embeddings existentes
  - Maneja la normalizaci√≥n de texto
  - Gestiona la cach√© de embeddings

- **Webhook**:
  - Recibe webhooks de Twilio
  - Valida mensajes entrantes
  - Env√≠a respuestas a WhatsApp
  - Maneja errores de comunicaci√≥n

#### 5. Bases de Datos
- **Conversaciones**:
  - Almacena historial de chat
  - Mantiene contexto de conversaci√≥n
  - Guarda res√∫menes de preferencias

- **Embeddings**:
  - Almacena embeddings de autos
  - Mantiene metadatos de actualizaci√≥n
  - Optimiza b√∫squedas sem√°nticas

- **Cat√°logo**:
  - Almacena informaci√≥n de autos
  - Mantiene caracter√≠sticas y precios
  - Actualizaci√≥n peri√≥dica

#### 6. Servicios Externos
- **OpenAI**:
  - GPT-3.5 Turbo para conversaci√≥n
  - Embeddings API para b√∫squeda sem√°ntica
  - Optimizaci√≥n de prompts

## Desarrollo

### Requisitos
- Python 3.9+
- AWS SAM CLI
- Docker (para desarrollo local)
- OpenAI API Key
- Cuenta de AWS con permisos adecuados
- Cuenta de Twilio (para WhatsApp)

### Variables de Entorno
```bash
# OpenAI
OPENAI_API_KEY=sk-...

# AWS
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...
AWS_REGION=us-east-1

# DynamoDB
CATALOG_TABLE=kavak-catalog-{stage}
EMBEDDINGS_TABLE=kavak-embeddings-{stage}
STAGE=dev|prod

# Twilio
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...
TWILIO_PHONE_NUMBER=whatsapp:+14155238886  # N√∫mero de WhatsApp de Twilio
```

### Tutorial de Configuraci√≥n

#### 1. Configurar AWS
1. Crear una cuenta en AWS si no tienes una
2. Crear un usuario IAM con los siguientes permisos:
   - AWSLambdaFullAccess
   - AmazonDynamoDBFullAccess
   - AmazonAPIGatewayAdministrator
   - CloudWatchFullAccess
   - AWSXRayFullAccess
   - AWSStepFunctionsFullAccess
3. Generar credenciales de acceso (Access Key y Secret Key)
4. Configurar AWS CLI:
```bash
aws configure
# Ingresar Access Key, Secret Key y regi√≥n (ej: us-east-1)
```

#### 2. Configurar Twilio
1. Crear una cuenta en Twilio (https://www.twilio.com)
2. Obtener Account SID y Auth Token del dashboard
3. Configurar WhatsApp Sandbox:
   - Ir a Twilio Console > Messaging > Try it out > Send a WhatsApp message
   - Seguir las instrucciones para activar el sandbox
   - Guardar el n√∫mero de WhatsApp de Twilio (formato: whatsapp:+14155238886)
4. Configurar webhook:
   - En Twilio Console > Messaging > Settings > WhatsApp Sandbox Settings
   - Configurar "WHEN A MESSAGE COMES IN" con la URL de tu API Gateway
   - URL ejemplo: `https://{api-id}.execute-api.{region}.amazonaws.com/{stage}/webhook`

#### 3. Configurar OpenAI
1. Crear una cuenta en OpenAI (https://platform.openai.com)
2. Generar una API Key
3. Verificar que la API Key tenga acceso a:
   - GPT-3.5 Turbo
   - Embeddings API

#### 4. Configurar el Proyecto
1. Clonar el repositorio:
```bash
git clone git@github.com:DanteRangel/kavak-ai-agent.git
cd kavak-ai-agent
```

2. Crear y activar entorno virtual:
```bash
python -m venv venv
source venv/bin/activate  # En Windows: venv\Scripts\activate
```

3. Instalar dependencias:
```bash
pip install -r requirements.txt
```

4. Crear archivo de variables de entorno:
```bash
cp .env.example .env
# Editar .env con tus credenciales
```

5. Iniciar DynamoDB local:
```bash
docker run -p 8000:8000 amazon/dynamodb-local
```

6. Crear tablas localmente:
```bash
aws dynamodb create-table \
    --table-name kavak-catalog-dev \
    --attribute-definitions AttributeName=stockId,AttributeType=S \
    --key-schema AttributeName=stockId,KeyType=HASH \
    --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5 \
    --endpoint-url http://localhost:8000

aws dynamodb create-table \
    --table-name kavak-embeddings-dev \
    --attribute-definitions AttributeName=stockId,AttributeType=S \
    --key-schema AttributeName=stockId,KeyType=HASH \
    --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5 \
    --endpoint-url http://localhost:8000
```

7. Importar cat√°logo de prueba:
```bash
python -m app.scripts.import_catalog sample_caso_ai_engineer.csv --table kavak-catalog-dev
```

8. Probar localmente:
```bash
sam local start-api
```

#### 5. Despliegue a AWS
1. Construir la aplicaci√≥n:
```bash
sam build
```

2. Desplegar a desarrollo:
```bash
sam deploy --guided --stack-name kavak-ai-agent-dev
```
o si tienes algun problema
```bash
rm -rf .aws-sam/build && sam build --use-container &&  sam deploy --stack-name kavak-ai-agent --parameter-overrides $(cat env.json | jq -r '.Parameters | to_entries | map("\(.key)=\(.value)") | join(" ")')  --no-fail-on-empty-changeset --resolve-s3 --resolve-s3 --capabilities CAPABILITY_IAM
```

3. Verificar Step Functions:
   - Ir a AWS Console > Step Functions
   - Verificar que se cre√≥ el flujo:
     - `kavak-ai-agent-dev-conversation-flow`
     ```

4. Actualizar webhook de Twilio:
   - Copiar la URL de API Gateway del output de SAM
   - Actualizar en Twilio Console > Messaging > Settings > WhatsApp Sandbox Settings
   - Asegurarse que el webhook apunte al endpoint que inicia el flujo de conversaci√≥n

5. Probar el webhook:
   - Enviar "Hola" al n√∫mero de WhatsApp de Twilio
   - Verificar logs en CloudWatch
   - Verificar el flujo en Step Functions
   - Verificar respuesta en WhatsApp

#### 6. Monitoreo
1. CloudWatch Logs:
   - Revisar logs de las funciones Lambda
   - Configurar alarmas para errores

2. X-Ray:
   - Verificar trazas de las funciones
   - Analizar tiempos de respuesta

3. DynamoDB:
   - Monitorear capacidad de lectura/escritura
   - Verificar tama√±o de las tablas

4. Step Functions:
   - Monitorear ejecuciones de los flujos
   - Revisar m√©tricas de √©xito/error
   - Configurar alarmas para fallos
   - Verificar tiempos de ejecuci√≥n

### Estructura del Proyecto
```
kavak-ai-agent/
‚îú‚îÄ‚îÄ template.yaml         # Configuraci√≥n de SAM
‚îú‚îÄ‚îÄ requirements.txt      # Dependencias de Python
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ scripts/         # Scripts de utilidad
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ import_catalog.sh    # Script para importar cat√°logo
‚îÇ   ‚îú‚îÄ‚îÄ functions/       # Funciones Lambda
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/       # Funci√≥n de chat
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhook/    # Webhook de WhatsApp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ update_embeddings/  # Actualizaci√≥n de embeddings
‚îÇ   ‚îú‚îÄ‚îÄ core/           # C√≥digo compartido
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/   # Servicios compartidos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/      # Utilidades
‚îÇ   ‚îî‚îÄ‚îÄ layers/         # Capas Lambda compartidas
‚îî‚îÄ‚îÄ tests/              # Pruebas unitarias y de integraci√≥n
```

### Importar Cat√°logo

#### 1. Preparar el CSV
El archivo CSV debe tener las siguientes columnas:
- `stockId`: Identificador √∫nico del auto
- `make`: Marca del auto
- `model`: Modelo del auto
- `version`: Versi√≥n del auto (opcional)
- `year`: A√±o del auto
- `price`: Precio en pesos
- `km`: Kilometraje
- `bluetooth`: "S√≠" o "No"
- `carPlay`: "S√≠" o "No"
- `largo`: Largo en mm
- `ancho`: Ancho en mm
- `altura`: Altura en mm

#### 2. Requisitos
```bash
# Instalar dependencias
pip install csvkit  # Para csvjson
pip install jq      # Para procesamiento JSON
```

#### 3. Usar el Script de Importaci√≥n
```bash
# Dar permisos de ejecuci√≥n al script
chmod +x app/scripts/import_catalog.sh

# Importar a desarrollo
./app/scripts/import_catalog.sh catalogo.csv kavak-catalog-dev

# Importar a producci√≥n
./app/scripts/import_catalog.sh catalogo.csv kavak-catalog-prod
```

El script:
- Convierte el CSV a JSON usando `csvjson`
- Transforma los tipos de datos autom√°ticamente:
  - N√∫meros a tipo N
  - Booleanos a tipo BOOL
  - Texto a tipo S
- Filtra campos nulos o vac√≠os
- Importa registro por registro a DynamoDB
- Muestra progreso de importaci√≥n

#### 4. Verificar la Importaci√≥n
```bash
# Contar registros en la tabla
aws dynamodb scan \
    --table-name kavak-catalog-dev \
    --select COUNT \
    --region us-east-1

# Verificar algunos registros
aws dynamodb scan \
    --table-name kavak-catalog-dev \
    --limit 5 \
    --region us-east-1

# Verificar estructura de un registro
aws dynamodb get-item \
    --table-name kavak-catalog-dev \
    --key '{"stockId": {"S": "ID_DEL_AUTO"}}' \
    --region us-east-1
```

#### 5. Soluci√≥n de Problemas
1. **Error de Dependencias**:
   ```bash
   # Verificar instalaci√≥n de csvkit
   which csvjson
   
   # Verificar instalaci√≥n de jq
   which jq
   ```

2. **Error de Credenciales**:
   ```bash
   # Verificar credenciales
   aws sts get-caller-identity
   
   # Configurar credenciales si es necesario
   aws configure
   ```

3. **Error de Formato CSV**:
   - Verificar que el CSV tenga las columnas requeridas
   - Asegurar que los valores num√©ricos sean n√∫meros
   - Verificar que los booleanos sean "S√≠" o "No"

4. **Error de Permisos**:
   - Verificar que el usuario IAM tenga permisos para DynamoDB
   - Agregar pol√≠tica `AmazonDynamoDBFullAccess` si es necesario

#### 6. Monitoreo
1. **CloudWatch Metrics**:
   - `ConsumedWriteCapacityUnits`
   - `ThrottledRequests`
   - `SystemErrors`

2. **DynamoDB Console**:
   - Verificar m√©tricas de la tabla
   - Revisar capacidad consumida
   - Monitorear errores de throttling

## Uso

### B√∫squeda de Autos
- Por descripci√≥n: "busca un auto econ√≥mico familiar"
- Por marca/modelo: "mu√©strame Volkswagens Golf"
- Por precio: "autos entre 300 y 400 mil pesos"
- Por caracter√≠sticas: "autos con bluetooth y carplay"

### Financiamiento
- "calcula el financiamiento para un auto de 500 mil pesos con enganche de 100 mil"
- "mu√©strame opciones a 48 meses"

### Detalles
- "dame m√°s detalles del Volkswagen Golf GTI Performance"
- "mu√©strame m√°s Chevrolets Spark ACTIV D"

## Arquitectura AWS

El proyecto utiliza una arquitectura serverless con los siguientes componentes:

- **AWS Lambda**: Para el procesamiento de mensajes y recomendaciones
- **Amazon API Gateway**: Para exponer los endpoints de la API
- **Amazon DynamoDB**: Para almacenar el cat√°logo, embeddings y conversaciones
- **Amazon CloudWatch**: Para monitoreo y logging
- **AWS X-Ray**: Para trazabilidad
- **AWS Step Functions**: Para orquestar el flujo de conversaci√≥n y actualizaci√≥n de embeddings

### Flujos de Step Functions

#### 1. Flujo de Conversaci√≥n
```mermaid
graph LR
    A[Webhook] --> B[Procesar Mensaje]
    B --> C{¬øNecesita Embedding?}
    C -->|S√≠| D[Actualizar Embedding]
    C -->|No| E[Generar Respuesta]
    D --> E
    E --> F[Enviar Respuesta]
    F --> G[Actualizar Contexto]
```

> **Nota**: La actualizaci√≥n de embeddings se maneja internamente dentro del flujo de conversaci√≥n cuando es necesario, no como un flujo separado.

#### 2. Flujo de Actualizaci√≥n de Embeddings
```mermaid
graph LR
    A[Trigger Diario] --> B[Obtener Cat√°logo]
    B --> C[Procesar Lote]
    C --> D{¬øM√°s Lotes?}
    D -->|S√≠| C
    D -->|No| E[Finalizar]
```

## Roadmap

1. **Fase 1: MVP**
   - Implementaci√≥n b√°sica de funciones Lambda
   - Integraci√≥n con WhatsApp
   - Sistema de recomendaci√≥n sem√°ntico
   - Despliegue inicial en AWS

2. **Fase 2: Mejoras**
   - Optimizaci√≥n de costos
   - Implementaci√≥n de cach√©
   - Mejoras en recomendaciones
   - Optimizaci√≥n de prompts

3. **Fase 3: Producci√≥n**
   - Monitoreo avanzado
   - Auto-scaling
   - Integraci√≥n con sistemas existentes
   - Implementaci√≥n de CI/CD

## M√©tricas de Evaluaci√≥n

- Precisi√≥n en recomendaciones
- Tasa de conversi√≥n
- Satisfacci√≥n del usuario
- Tiempo de respuesta
- Tasa de resoluci√≥n de consultas
- Costos operativos
- Tiempo de ejecuci√≥n Lambda

## Contribuci√≥n

1. Fork el proyecto
2. Crear una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abrir un Pull Request

## Licencia

Este proyecto es privado y confidencial para Kavak. 